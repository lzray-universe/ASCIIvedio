#pragma once

#include <array>
#include <cstdint>

namespace asciiplay::font8x16 {

// Font data derived from the public domain "font8x8" project. Each glyph is
// stored as 8x8 bitmap; we expand rows to 8x16 during rasterization by
// duplicating lines. This keeps the dataset compact while satisfying the 8x16
// requirement for exporters.

struct Glyph8x8 {
    std::array<uint8_t, 8> rows;
};

inline constexpr std::array<Glyph8x8, 95> basic_font = { {
    {{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}}, // ' '
    {{0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00}}, // '!'
    {{0x36,0x36,0x24,0x00,0x00,0x00,0x00,0x00}}, // '"'
    {{0x36,0x36,0x7F,0x36,0x7F,0x36,0x36,0x00}}, // '#'
    {{0x0C,0x3F,0x68,0x3E,0x0B,0x7E,0x18,0x00}}, // '$'
    {{0x63,0x66,0x0C,0x18,0x30,0x66,0xC6,0x00}}, // '%'
    {{0x1C,0x36,0x1C,0x6E,0x3B,0x33,0x6E,0x00}}, // '&'
    {{0x06,0x0C,0x18,0x00,0x00,0x00,0x00,0x00}}, // '''
    {{0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00}}, // '('
    {{0x30,0x18,0x0C,0x0C,0x0C,0x18,0x30,0x00}}, // ')'
    {{0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00}}, // '*'
    {{0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00}}, // '+'
    {{0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x30}}, // ','
    {{0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00}}, // '-'
    {{0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00}}, // '.'
    {{0x03,0x06,0x0C,0x18,0x30,0x60,0xC0,0x00}}, // '/'
    {{0x3E,0x63,0x73,0x7B,0x6F,0x67,0x3E,0x00}}, // '0'
    {{0x18,0x38,0x18,0x18,0x18,0x18,0x7E,0x00}}, // '1'
    {{0x3C,0x66,0x06,0x1C,0x30,0x66,0x7E,0x00}}, // '2'
    {{0x3C,0x66,0x06,0x1C,0x06,0x66,0x3C,0x00}}, // '3'
    {{0x0E,0x1E,0x36,0x66,0x7F,0x06,0x06,0x00}}, // '4'
    {{0x7E,0x60,0x7C,0x06,0x06,0x66,0x3C,0x00}}, // '5'
    {{0x1C,0x30,0x60,0x7C,0x66,0x66,0x3C,0x00}}, // '6'
    {{0x7E,0x66,0x06,0x0C,0x18,0x18,0x18,0x00}}, // '7'
    {{0x3C,0x66,0x66,0x3C,0x66,0x66,0x3C,0x00}}, // '8'
    {{0x3C,0x66,0x66,0x3E,0x06,0x0C,0x38,0x00}}, // '9'
    {{0x00,0x18,0x18,0x00,0x00,0x18,0x18,0x00}}, // ':'
    {{0x00,0x18,0x18,0x00,0x00,0x18,0x18,0x30}}, // ';'
    {{0x0E,0x1C,0x38,0x70,0x38,0x1C,0x0E,0x00}}, // '<'
    {{0x00,0x00,0x7E,0x00,0x7E,0x00,0x00,0x00}}, // '='
    {{0x70,0x38,0x1C,0x0E,0x1C,0x38,0x70,0x00}}, // '>'
    {{0x3C,0x66,0x06,0x0C,0x18,0x00,0x18,0x00}}, // '?'
    {{0x3C,0x66,0x6E,0x6A,0x6E,0x60,0x3C,0x00}}, // '@'
    {{0x18,0x3C,0x66,0x66,0x7E,0x66,0x66,0x00}}, // 'A'
    {{0x7C,0x66,0x66,0x7C,0x66,0x66,0x7C,0x00}}, // 'B'
    {{0x3C,0x66,0x60,0x60,0x60,0x66,0x3C,0x00}}, // 'C'
    {{0x78,0x6C,0x66,0x66,0x66,0x6C,0x78,0x00}}, // 'D'
    {{0x7E,0x60,0x60,0x7C,0x60,0x60,0x7E,0x00}}, // 'E'
    {{0x7E,0x60,0x60,0x7C,0x60,0x60,0x60,0x00}}, // 'F'
    {{0x3C,0x66,0x60,0x6E,0x66,0x66,0x3C,0x00}}, // 'G'
    {{0x66,0x66,0x66,0x7E,0x66,0x66,0x66,0x00}}, // 'H'
    {{0x3C,0x18,0x18,0x18,0x18,0x18,0x3C,0x00}}, // 'I'
    {{0x1E,0x0C,0x0C,0x0C,0x0C,0x6C,0x38,0x00}}, // 'J'
    {{0x66,0x6C,0x78,0x70,0x78,0x6C,0x66,0x00}}, // 'K'
    {{0x60,0x60,0x60,0x60,0x60,0x60,0x7E,0x00}}, // 'L'
    {{0x63,0x77,0x7F,0x6B,0x63,0x63,0x63,0x00}}, // 'M'
    {{0x66,0x76,0x7E,0x7E,0x6E,0x66,0x66,0x00}}, // 'N'
    {{0x3C,0x66,0x66,0x66,0x66,0x66,0x3C,0x00}}, // 'O'
    {{0x7C,0x66,0x66,0x7C,0x60,0x60,0x60,0x00}}, // 'P'
    {{0x3C,0x66,0x66,0x66,0x6E,0x6C,0x36,0x00}}, // 'Q'
    {{0x7C,0x66,0x66,0x7C,0x78,0x6C,0x66,0x00}}, // 'R'
    {{0x3C,0x66,0x30,0x18,0x0C,0x66,0x3C,0x00}}, // 'S'
    {{0x7E,0x5A,0x18,0x18,0x18,0x18,0x3C,0x00}}, // 'T'
    {{0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x00}}, // 'U'
    {{0x66,0x66,0x66,0x66,0x66,0x3C,0x18,0x00}}, // 'V'
    {{0x63,0x63,0x63,0x6B,0x7F,0x77,0x63,0x00}}, // 'W'
    {{0x66,0x66,0x3C,0x18,0x3C,0x66,0x66,0x00}}, // 'X'
    {{0x66,0x66,0x3C,0x18,0x18,0x18,0x3C,0x00}}, // 'Y'
    {{0x7E,0x06,0x0C,0x18,0x30,0x60,0x7E,0x00}}, // 'Z'
    {{0x3C,0x30,0x30,0x30,0x30,0x30,0x3C,0x00}}, // '['
    {{0xC0,0x60,0x30,0x18,0x0C,0x06,0x03,0x00}}, // '\\'
    {{0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3C,0x00}}, // ']'
    {{0x08,0x1C,0x36,0x63,0x00,0x00,0x00,0x00}}, // '^'
    {{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF}}, // '_'
    {{0x18,0x18,0x0C,0x00,0x00,0x00,0x00,0x00}}, // '`'
    {{0x00,0x00,0x3C,0x06,0x3E,0x66,0x3E,0x00}}, // 'a'
    {{0x60,0x60,0x7C,0x66,0x66,0x66,0x7C,0x00}}, // 'b'
    {{0x00,0x00,0x3C,0x66,0x60,0x66,0x3C,0x00}}, // 'c'
    {{0x06,0x06,0x3E,0x66,0x66,0x66,0x3E,0x00}}, // 'd'
    {{0x00,0x00,0x3C,0x66,0x7E,0x60,0x3C,0x00}}, // 'e'
    {{0x1C,0x36,0x30,0x78,0x30,0x30,0x78,0x00}}, // 'f'
    {{0x00,0x00,0x3E,0x66,0x66,0x3E,0x06,0x3C}}, // 'g'
    {{0x60,0x60,0x7C,0x66,0x66,0x66,0x66,0x00}}, // 'h'
    {{0x18,0x00,0x38,0x18,0x18,0x18,0x3C,0x00}}, // 'i'
    {{0x06,0x00,0x06,0x06,0x06,0x66,0x66,0x3C}}, // 'j'
    {{0x60,0x60,0x66,0x6C,0x78,0x6C,0x66,0x00}}, // 'k'
    {{0x38,0x18,0x18,0x18,0x18,0x18,0x3C,0x00}}, // 'l'
    {{0x00,0x00,0x6C,0x7E,0x7E,0x6B,0x63,0x00}}, // 'm'
    {{0x00,0x00,0x7C,0x66,0x66,0x66,0x66,0x00}}, // 'n'
    {{0x00,0x00,0x3C,0x66,0x66,0x66,0x3C,0x00}}, // 'o'
    {{0x00,0x00,0x7C,0x66,0x66,0x7C,0x60,0x60}}, // 'p'
    {{0x00,0x00,0x3E,0x66,0x66,0x3E,0x06,0x06}}, // 'q'
    {{0x00,0x00,0x7C,0x66,0x60,0x60,0x60,0x00}}, // 'r'
    {{0x00,0x00,0x3E,0x60,0x3C,0x06,0x7C,0x00}}, // 's'
    {{0x30,0x30,0x7C,0x30,0x30,0x36,0x1C,0x00}}, // 't'
    {{0x00,0x00,0x66,0x66,0x66,0x66,0x3E,0x00}}, // 'u'
    {{0x00,0x00,0x66,0x66,0x66,0x3C,0x18,0x00}}, // 'v'
    {{0x00,0x00,0x63,0x6B,0x7F,0x7F,0x36,0x00}}, // 'w'
    {{0x00,0x00,0x66,0x3C,0x18,0x3C,0x66,0x00}}, // 'x'
    {{0x00,0x00,0x66,0x66,0x66,0x3E,0x06,0x3C}}, // 'y'
    {{0x00,0x00,0x7E,0x0C,0x18,0x30,0x7E,0x00}}, // 'z'
    {{0x0E,0x18,0x18,0x70,0x18,0x18,0x0E,0x00}}, // '{'
    {{0x18,0x18,0x18,0x00,0x18,0x18,0x18,0x00}}, // '|'
    {{0x70,0x18,0x18,0x0E,0x18,0x18,0x70,0x00}}, // '}'
    {{0x36,0x7F,0x49,0x00,0x00,0x00,0x00,0x00}}, // '~'
} };

inline constexpr int glyph_width = 8;
inline constexpr int glyph_height = 16;

inline void blit_glyph(uint32_t* dst, int dstStride, char c, uint32_t fg, uint32_t bg)
{
    if (c < 32 || c > 126) c = '?';
    const auto& glyph = basic_font[c - 32];
    for (int y = 0; y < glyph_height; ++y) {
        uint8_t rowBits = glyph.rows[y / 2];
        for (int x = 0; x < glyph_width; ++x) {
            bool on = (rowBits >> x) & 0x1;
            dst[y * dstStride + x] = on ? fg : bg;
        }
    }
}

} // namespace asciiplay::font8x16
